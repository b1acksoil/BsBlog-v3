<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>技术 on BsBlog</title><link>https://sorabs.cc/categories/tech/</link><description>Recent content in 技术 on BsBlog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="https://sorabs.cc/categories/tech/index.xml" rel="self" type="application/rss+xml"/><item><title>树莓派搭建 FTP 服务器实现局域网文件共享</title><link>https://sorabs.cc/posts/raspberrypi-ftp-server/</link><pubDate>Wed, 14 Sep 2022 20:34:14 +0800</pubDate><guid>https://sorabs.cc/posts/raspberrypi-ftp-server/</guid><description>&lt;img src="https://sorabs.cc/posts/raspberrypi-ftp-server/cover.jpg" alt="Featured image of post 树莓派搭建 FTP 服务器实现局域网文件共享" />&lt;h2 id="起因">起因&lt;/h2>
&lt;p>经常需要在电脑和手机之间互传文件，想了不少办法，最早是使用 QQ 等聊天工具进行文件传输，效率十分低下；后来找到了 &lt;a class="link" href="https://snapdrop.net/" target="_blank" rel="noopener"
>SnapDrop&lt;/a> 这款工具，可以以类似面对面快传的方式在局域网内传输文件，提高了些许效率，但还是感觉到些许别扭。于是开始找寻一种更为优雅的文件传输方式，想到手里有一个半吃灰的树莓派，就开始着手搭建自己的 FTP 文件服务器。&lt;/p>
&lt;div class="tip tip-quote">
&lt;div class="tip-header">什么是 FTP&lt;/div>
&lt;div class="tip-content">文件传输协议（File Transfer Protocol，缩写 &lt;strong>FTP&lt;/strong>）是一个用于在计算机网络上在客户端和服务器之间进行文件传输的应用层协议。&lt;/div>
&lt;/div>
&lt;p>相比 WebDav 等其他传输协议，纯 FTP 的安全性略显低下，但对于小型自用而言已经绰绰有余。&lt;/p>
&lt;h2 id="搭建">搭建&lt;/h2>
&lt;div class="tip tip-info">
&lt;div class="tip-header">关于树莓派&lt;/div>
&lt;div class="tip-content">本文中使用的树莓派信息如下：&lt;br>
型号：4B&lt;br>
RAM：4GB&lt;br>
系统：Ubuntu Server 22.04&lt;/div>
&lt;/div>
&lt;p>首先安装软件包 &lt;code>vsftpd&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo apt install vsftpd -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装过程中会自动创建一个名为 &lt;code>ftp&lt;/code> 的用户，我们给它设置一个密码作为稍后的登录密码（若打算开启匿名登录可跳过）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo passwd ftp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="tip tip-info">
&lt;div class="tip-header">FTP 文件存放位置&lt;/div>
&lt;div class="tip-content">FTP 服务开启后的文件存储位置就是 &lt;code>frp&lt;/code> 用户的家目录，位于 &lt;code>/srv/ftp&lt;/code>&lt;/div>
&lt;/div>
&lt;p>密码更改完成后，选用喜欢的编辑器打开 FTP 服务器配置文件 &lt;code>/etc/vsftpd.conf&lt;/code>，按照需求取消注释（去掉行首的 &lt;code>#&lt;/code> 号）或修改相应选项（如果找不到被注释的选项在哪里也可以直接在文件末尾添加，格式为 &lt;code>选项=值&lt;/code>）。这里列出几个常用的，&lt;code>YES/NO&lt;/code> 分别对应是/否：&lt;/p>
&lt;p>&lt;strong>通用&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;code>local_enable&lt;/code>&lt;/strong>：是否允许本地用户登录&lt;br>
&lt;strong>&lt;code>write_enable&lt;/code>&lt;/strong>：是否允许写入操作（上传文件、新建文件夹等）&lt;br>
&lt;strong>&lt;code>utf8_filesystem&lt;/code>&lt;/strong>：启用 UTF-8 支持&lt;/p>
&lt;p>&lt;strong>匿名登录相关&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;code>anonymous_enable&lt;/code>&lt;/strong>：是否允许匿名登录&lt;br>
&lt;strong>&lt;code>anon_upload_enable&lt;/code>&lt;/strong>：是否允许匿名用户上传文件&lt;br>
&lt;strong>&lt;code>anon_mkdir_write_enable&lt;/code>&lt;/strong>：是否允许匿名用户新建文件夹&lt;/p>
&lt;p>&lt;strong>&lt;a class="link" href="https://zh.wikipedia.org/wiki/Chroot" target="_blank" rel="noopener"
>Chroot&lt;/a> 相关&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;code>chroot_local_user&lt;/code>&lt;/strong>：是否将连接 FTP 的本地用户的根目录限制为其家目录（&lt;code>/home/&amp;lt;username&amp;gt;&lt;/code>）&lt;br>
&lt;strong>&lt;code>chroot_list_enable&lt;/code>&lt;/strong>：启用 chroot 白名单，只有在其中的用户&lt;strong>才会&lt;/strong>被 chroot（如果把 &lt;code>chroot_local_user&lt;/code> 设置为 &lt;code>YES&lt;/code> 将变为黑名单，只有在其中的用户&lt;strong>不会&lt;/strong>被 chroot）&lt;br>
&lt;strong>&lt;code>chroot_list_file&lt;/code>&lt;/strong>：chroot 黑/白名单的文件路径，文件中填写用户名，一行一个&lt;/p>
&lt;p>注：如果只设置 &lt;code>chroot_local_user&lt;/code> 为 &lt;code>YES&lt;/code> 而不设置黑/白名单，会对所有连接 FTP 的本地用户进行 chroot。&lt;/p>
&lt;p>修改好配置后重启 FTP 服务：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo systemctl restart vsftpd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="连接">连接&lt;/h2>
&lt;p>查看树莓派 IP，可以使用 &lt;code>ip addr&lt;/code> 或 &lt;code>ifconfig&lt;/code> 等等方式。这里举例为 &lt;code>192.168.0.114&lt;/code>，后续命令中记得替换成自己的。&lt;/p>
&lt;p>使用 FTP 工具进行连接测试，这里先使用 Linux 和 Windows 都自带的 &lt;code>ftp&lt;/code> 命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ ftp 192.168.0.114
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>提示输入用户名和密码，用户名输入 &lt;code>ftp&lt;/code>，密码输入之前设置的密码，若设置了匿名就直接留空回车。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Connected to 192.168.0.114.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">220 (vsFTPd 3.0.5)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name (192.168.0.114:bs): ftp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">331 Please specify the password.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">230 Login successful.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ftp&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>成功进入 FTP Shell 后可以输入 &lt;code>ls&lt;/code>，&lt;code>pwd&lt;/code> 等命令进行测试，使用 &lt;code>quit&lt;/code> 退出。&lt;/p>
&lt;div class="tip tip-success">
&lt;div class="tip-header">搭建完成&lt;/div>
&lt;div class="tip-content">&lt;p>一个简单的 FTP 服务器已经搭建完毕，可以使用各种 FTP 工具连接使用。&lt;/p>
&lt;p>如果搭建过程中遇到问题，可以参考文章后面的问题解决部分。&lt;/p>
&lt;/div>
&lt;/div>
&lt;h2 id="体验">体验&lt;/h2>
&lt;p>搭建完成后，我分别使用移动端的 MT 管理器、和 Windows 自带的网络位置进行了测试。在 MT 管理器下连接后操作十分流畅，上传/下载的速度也很快。而 Windows 自带的网络位置则十分难用，打开文件只打开了一个空的 Edge，复制文件十分缓慢，新建文件夹需要延迟很久，删除文件也经常删不掉。&lt;del>fkms&lt;/del>&lt;/p>
&lt;p>但尽管如此，通过 FTP 传输文件仍然带来了一种全新的体验：手机上将文件移进”文件夹“，转眼就能在电脑上移出来使用，做到了几近原生、无缝的传输体验。相信如果解决了 Windows 端的工具问题，效率会大大提升。&lt;/p>
&lt;h2 id="问题解决">问题解决&lt;/h2>
&lt;h3 id="无法登录进-ftp-shell">无法登录进 FTP Shell&lt;/h3>
&lt;div class="tip tip-quote">
&lt;div class="tip-header">Ubuntu 官网的说明&lt;/div>
&lt;div class="tip-content">&lt;p>To allow users with a shell of /usr/sbin/nologin access to FTP, but have no shell access, edit /etc/shells adding the nologin shell.&lt;/p>
&lt;p>This is necessary because, by default vsftpd uses PAM for authentication, and the /etc/pam.d/vsftpd configuration file contains:&lt;/p>
&lt;p>&lt;code>auth&lt;/code> &lt;code>required&lt;/code>  &lt;code>pam_shells.so&lt;/code>&lt;/p>
&lt;p>The shells PAM module restricts access to shells listed in the /etc/shells file.&lt;/p>
&lt;p>摘自&lt;a class="link" href="https://ubuntu.com/server/docs/service-ftp" target="_blank" rel="noopener"
>这里&lt;/a>&lt;/p>
&lt;/div>
&lt;/div>
&lt;p>解决办法：编辑 &lt;code>/etc/shells&lt;/code>，在文件末尾添加一行 &lt;code>/usr/sbin/nologin&lt;/code>&lt;/p>
&lt;h3 id="550-create-directory-operation-failed">550 create directory operation failed&lt;/h3>
&lt;p>如果设置了 &lt;code>write_enable&lt;/code> 后仍不能创建文件夹，需要确保根目录具有可执行权限。执行以下命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ chmod &lt;span class="m">777&lt;/span> -R /srv/ftp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="vsftpd-refusing-to-run-with-writable-root-inside-chroot">vsftpd: refusing to run with writable root inside chroot&lt;/h3>
&lt;p>如果设置了 chroot 后无法新建文件夹/上传文件，并提示以上信息，是因为 &lt;code>2.3.5&lt;/code> 版本后 &lt;code>vsftpd&lt;/code> 加强了安全检查，用户的主目录不能再有写权限，如果检查到就会报错。可以在配置文件中添加 &lt;code>allow_writeable_chroot=YES&lt;/code> 来解决。&lt;/p>
&lt;p>参考自&lt;a class="link" href="https://blog.csdn.net/bluishglc/article/details/42399439" target="_blank" rel="noopener"
>这里&lt;/a>&lt;/p></description></item><item><title>星露谷模组加载器 —— SMAPI 的安装</title><link>https://sorabs.cc/posts/smapi-install/</link><pubDate>Tue, 13 Sep 2022 19:34:50 +0800</pubDate><guid>https://sorabs.cc/posts/smapi-install/</guid><description>&lt;p>一直听说&lt;a class="link" href="https://store.steampowered.com/app/413150/Stardew_Valley/?l=schinese" target="_blank" rel="noopener"
>星露谷&lt;/a>对于 Mod 的支持十分完善，这次打算自己尝试一番。&lt;/p>
&lt;div class="tip tip-info">
&lt;div class="tip-header">注意&lt;/div>
&lt;div class="tip-content">本文仅针对 Windows 平台，其他平台方法大同小异，可以直接参照&lt;a class="link" href="https://zh.stardewvalleywiki.com/%E6%A8%A1%E7%BB%84:%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/%E5%85%A5%E9%97%A8" target="_blank" rel="noopener"
>官方 Wiki&lt;/a>。&lt;/div>
&lt;/div>
&lt;p>首先到 &lt;a class="link" href="https://smapi.io/" target="_blank" rel="noopener"
>SMAPI 官网&lt;/a>下载最新的安装包，可以选择从 NexusMods (N 网) 下载，也可以直接下载 (Direct download)。截至本文，SMAPI 的最新版本为 &lt;code>3.16.2&lt;/code>。&lt;/p>
&lt;p>把下载下来的 &lt;code>SMAPI-&amp;lt;版本&amp;gt;-installer.zip&lt;/code> 解压到任意位置，打开里面的 &lt;code>install on Windows.bat&lt;/code>，安装脚本会自动检测游戏的安装位置。如果没有找到会提示以下信息：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Oops, couldn&amp;#39;t find the game automatically.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type the file path to the game directory (the one containing &amp;#39;Stardew Valley.dll&amp;#39;), then press enter.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>出现这种情况，首先找到星露谷的安装目录，若为 Steam 安装可以直接右键库里的星露谷，选择管理 - 浏览本地文件，然后复制打开的文件夹路径（例如我的是 &lt;code>D:\Steam\steamapps\common\Stardew Valley&lt;/code>），再粘贴进终端内并回车。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">What do you want to do?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[1] Install SMAPI.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2] Uninstall SMAPI.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type 1 or 2, then press enter.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>输入 1 并回车继续安装。日后如果想要卸载 SMAPI，可以再次运行此脚本并选择 2 卸载。&lt;/p>
&lt;p>如果出现以下信息，则为安装成功：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">SMAPI is installed! If you use Steam, set your launch options to enable achievements (see smapi.io/install):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;D:\Steam\steamapps\common\Stardew Valley\StardewModdingAPI.exe&amp;#34; %command%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If you don&amp;#39;t use Steam, launch StardewModdingAPI.exe in your game folder to play with mods.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>提示信息中指出，如果使用 Steam 启动游戏，可以设置启动项来确保安装 SMAPI 后也能正常获得成就。&lt;/p>
&lt;div class="tip tip-warn">
&lt;div class="tip-header">注意&lt;/div>
&lt;div class="tip-content">在配置Steam启动项之前，需要确保您的游戏路径里没有中文，否则将设置失败。&lt;/div>
&lt;/div>
&lt;p>首先复制终端窗口中给出的启动指令（如上文，为 &lt;code>&amp;quot;D:\Steam\steamapps\common\Stardew Valley\StardewModdingAPI.exe&amp;quot; %command%&lt;/code>），Steam 中右键星露谷打开属性，在“通用”选项卡中把复制的指令粘贴进“启动选项”一栏，保存即可。&lt;/p>
&lt;p>至此已经完成了 SMAPI 的安装，至于添加 Mod 下次再讲 &lt;del>（咕咕咕（（&lt;/del>&lt;/p></description></item></channel></rss>